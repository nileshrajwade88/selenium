/**
 * @author     Sudhindra Immidi
 *  
 */

package com.pru.utilities;

import java.io.File;
import org.apache.commons.io.FileUtils;
import org.testng.ISuite;
import org.testng.ISuiteListener;
import org.testng.Reporter;

public class TestSuiteListener extends ConfigProperties implements ISuiteListener {
	
	@Override
	public void onFinish(ISuite suite) {
		Reporter.setEscapeHtml(false);
		try {
			closeReport();
			if(CloudTesting ==false) Grid_Builder.clearHubandNodes();
			UpdateTestExecutionMatrix();

			TestDataProvider.export_Results(CurrentPublishReportHtml);
		} catch (Exception e) {
			e.printStackTrace();
		}
	}

	@Override
	public void onStart(ISuite suite) {
		try {
			ConcurrentUpdates.initializeExecutionLog();
			TestcasesUpdate();
			System.out.println("Outside CloudTesting On start:"+CloudTesting);
			if(CloudTesting ==false){
				System.out.println("Inside CloudTesting On False");
				Grid_Builder.clearHubandNodes();
				Grid_Builder.buildHubandNodes();
			}		

			// Delete old screenshots from local screenshots folder 
			String localOldSnapsPath = System.getProperty("user.dir")+"/screenshots/";
			String localBackUpSnapsPath = System.getProperty("user.dir")+"/old_screenshots/";	
			File oldSnaps = new File(localOldSnapsPath);
			File backUpSnapsPath = new File(localBackUpSnapsPath);
			FileUtils.copyDirectory(oldSnaps, backUpSnapsPath);
			File[] listOfFiles = oldSnaps.listFiles(); 
			for (int i = 0; i < listOfFiles.length; i++) 
			{
				if (listOfFiles[i].isFile()) {					
					listOfFiles[i].delete();
				}
			}

			initiateReport(CurrentPublishReportHtml);
		} catch (Exception e) {
			e.printStackTrace();
		}
	}
}
